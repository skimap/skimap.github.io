<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_21114c0494e2dc7651fcbfec261e5e6c {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>

            <style>html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            </style>

            <style>#map {
                position:absolute;
                top:0;
                bottom:0;
                right:0;
                left:0;
                }
            </style>

            <script>
                L_NO_TOUCH = false;
                L_DISABLE_3D = false;
            </script>

        
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HLZTNBRD6S"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments)}
      gtag('js', new Date());
      gtag('config', 'G-HLZTNBRD6S');
    </script>
    </head>
<body>
    
    
    <div id="ski-selector" style="position:absolute;top:10px;right:50px;z-index:1000;background:white;padding:5px;border-radius:8px;">
        <label for="area">Síterep:</label>
        <select id="area">
            <option value="all">Minden</option>
        </select>
    </div>
    <div id="scheme-selector" style="position:absolute;top:80px;right:50px;z-index:1000;background:white;padding:5px;border-radius:8px;">
        <label for="scheme">Pályaszínek:</label>
        <select id="scheme">
            <option value="1">EU</option>
            <option value="2">HU</option>
        </select>
    </div>
    
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const map = window['map_21114c0494e2dc7651fcbfec261e5e6c'];
        const MIN_ZOOM = 14;
        const lineWidth = 3;
        let loadedFiles = new Set();
        let lastUpdate = 0;
        const UPDATE_INTERVAL = 100;
        const MAX_LOAD_DISTANCE = 0.2;
        const skiAreas = {"Sölden": {"type": "Point", "coordinates": [10.977332376239959, 46.95369182328437]}, "Obertauern": {"type": "Point", "coordinates": [13.556663033635594, 47.25375481146294]}, "Val Gardena, Gröden, Gherdëina": {"type": "Polygon", "coordinates": [[[11.8032876, 46.554665099999994], [11.7930159, 46.5551669], [11.792082800000003, 46.5553605], [11.7802164, 46.5578229], [11.7750129, 46.559829499999985], [11.775206, 46.562913000000016], [11.774310199999999, 46.564687099999986], [11.7717299, 46.5645211], [11.7658773, 46.56214580000002], [11.7417804, 46.56077370000001], [11.7387441, 46.5641818], [11.7419306, 46.5706432], [11.7497626, 46.5744784], [11.753378199999998, 46.5796555], [11.7551056, 46.585186], [11.753507, 46.586528], [11.748378599999993, 46.586823], [11.744011899999997, 46.58910870000001], [11.7392054, 46.5944761], [11.741072199999998, 46.59816950000001], [11.7390981, 46.59959960000001], [11.7291981, 46.6002594], [11.727671899999997, 46.60079200000001], [11.7255516, 46.6008565], [11.7236875, 46.599157300000016], [11.7220138, 46.595117500000015], [11.7134629, 46.5960316], [11.7056094, 46.59532390000002], [11.6967259, 46.59833170000002], [11.6907929, 46.599909300000014], [11.6785191, 46.59840540000001], [11.671915499999999, 46.5795891], [11.670531500000003, 46.5758207], [11.677311399999997, 46.5753044], [11.6946922, 46.5794638], [11.6984902, 46.5832689], [11.7088542, 46.590258900000016], [11.7168579, 46.590030300000016], [11.720393099999997, 46.587317], [11.7232577, 46.58732439999999], [11.7257843, 46.59134270000001], [11.730977099999997, 46.59357660000001], [11.7357031, 46.5891972], [11.738752799999999, 46.581182], [11.738607999999997, 46.5730218], [11.7359311, 46.56843230000002], [11.7347939, 46.5658046], [11.721783499999999, 46.557493199999996], [11.718864199999999, 46.555628], [11.712544900000003, 46.55533290000002], [11.7076794, 46.5536508], [11.699021199999999, 46.5468626], [11.6989844, 46.53997500000001], [11.7060057, 46.541549599999996], [11.7139129, 46.5415939], [11.7192451, 46.5361917], [11.735542200000003, 46.5332986], [11.7404667, 46.53061190000001], [11.744441799999999, 46.5288035], [11.745681, 46.52330780000001], [11.74184, 46.506484199999996], [11.7512674, 46.5060172], [11.760201799999999, 46.5070934], [11.7754749, 46.509867099999994], [11.774273299999997, 46.5248839], [11.7809457, 46.5245454], [11.7811621, 46.52613230000003], [11.775442700000003, 46.53226530000001], [11.7737329, 46.53373470000001], [11.7722844, 46.5349795], [11.7715012, 46.5402932], [11.7695647, 46.5512732], [11.7859047, 46.5490154], [11.7923461, 46.5497893], [11.795028199999999, 46.5489838], [11.7959777, 46.5490998], [11.797229999999999, 46.5495672], [11.7987397, 46.5496011], [11.8055204, 46.5485607], [11.8082576, 46.548756200000014], [11.807404200000004, 46.55081439999999], [11.807530400000003, 46.5511402], [11.807656500000004, 46.5515797], [11.8041169, 46.5543624], [11.8032876, 46.554665099999994]]]}, "Síaréna Vibe Park": {"type": "Polygon", "coordinates": [[[17.929972499999995, 47.2134237], [17.92977239999999, 47.2133618], [17.9294611, 47.213512600000016], [17.929252799999993, 47.2133266], [17.9289713, 47.21303930000001], [17.9290512, 47.21280080000001], [17.9269972, 47.2098801], [17.92293459999999, 47.21270860000001], [17.92249609999999, 47.2122245], [17.926522599999984, 47.20931890000003], [17.931598700000006, 47.2060643], [17.932686199999992, 47.2056076], [17.9329491, 47.206222300000015], [17.933414499999994, 47.207612800000014], [17.9345691, 47.20799690000001], [17.936531499999994, 47.20983620000001], [17.936739499999987, 47.211681099999986], [17.9344936, 47.2126295], [17.9310127, 47.2132714], [17.9302009, 47.2133236], [17.929972499999995, 47.2134237]]]}, "Alta Badia": {"type": "Polygon", "coordinates": [[[11.8032876, 46.554665099999994], [11.8041169, 46.5543624], [11.807656500000004, 46.5515797], [11.807530400000003, 46.5511402], [11.807404200000004, 46.55081439999999], [11.8082576, 46.548756200000014], [11.8104771, 46.54921], [11.8140337, 46.5483075], [11.8181428, 46.5478758], [11.820074, 46.5466344], [11.823544800000004, 46.546804099999996], [11.8273911, 46.5475936], [11.8332812, 46.546302300000015], [11.8342253, 46.54367530000001], [11.8380877, 46.5430001], [11.8466654, 46.547422], [11.850602900000004, 46.5494032], [11.853751800000003, 46.548484599999995], [11.858612, 46.5492003], [11.8700918, 46.547102], [11.8615517, 46.52695030000002], [11.8563911, 46.52542970000001], [11.8487951, 46.522576600000015], [11.848988199999999, 46.52158], [11.8508014, 46.52140280000001], [11.859545400000004, 46.5236691], [11.862222200000003, 46.52254890000002], [11.8673023, 46.52203950000001], [11.8683502, 46.5214196], [11.8713102, 46.519668499999995], [11.872145900000003, 46.5192538], [11.872624000000004, 46.5186916], [11.8737331, 46.5169499], [11.8775631, 46.515417], [11.885454200000007, 46.51529890000001], [11.9080411, 46.514946099999996], [11.9180725, 46.5242555], [11.9188651, 46.532536000000015], [11.9288429, 46.5407798], [11.9318041, 46.54777530000001], [11.9460949, 46.5545191], [11.952245200000004, 46.554419], [11.954026200000003, 46.5534156], [11.9582534, 46.55113580000001], [11.963768, 46.54803680000001], [11.966289300000003, 46.5480811], [11.9681024, 46.5491067], [11.9732523, 46.5538583], [11.9771147, 46.5559684], [11.9809714, 46.5567725], [11.977189800000003, 46.5582701], [11.975864800000004, 46.558392800000014], [11.9744056, 46.5570529], [11.973080600000003, 46.5562229], [11.9720104, 46.555699499999996], [11.970385, 46.55536520000001], [11.9684739, 46.5552361], [11.9663738, 46.5550046], [11.965715300000003, 46.55513840000001], [11.965743400000003, 46.5559066], [11.966212500000003, 46.55653820000001], [11.963576000000003, 46.55851540000001], [11.959227, 46.5594952], [11.9585886, 46.559853], [11.954602800000004, 46.5612491], [11.9408914, 46.565575500000016], [11.939937500000003, 46.5666364], [11.9387939, 46.56790820000001], [11.936492600000003, 46.5680834], [11.9324639, 46.5671245], [11.924825, 46.5618577], [11.9206407, 46.5610241], [11.9177225, 46.564126], [11.9205227, 46.5707534], [11.916756900000003, 46.57345280000001], [11.915963, 46.5766204], [11.9134739, 46.579518600000014], [11.9086674, 46.58214200000001], [11.907396, 46.5850234], [11.903218, 46.5857601], [11.8983623, 46.5864059], [11.892643800000004, 46.5880981], [11.893073, 46.5908925], [11.8982926, 46.59637580000002], [11.899783800000003, 46.5968366], [11.9011089, 46.59761250000001], [11.900666300000003, 46.599273900000014], [11.9001377, 46.60084439999999], [11.8981665, 46.6067004], [11.9111699, 46.6075315], [11.912704100000003, 46.609337300000014], [11.920375199999999, 46.6097795], [11.9297307, 46.6109403], [11.938378199999995, 46.61285280000001], [11.9394618, 46.61399330000001], [11.939553, 46.61462339999999], [11.937915499999999, 46.6150016], [11.935742900000003, 46.6147657], [11.9231794, 46.6136124], [11.9144676, 46.61219730000001], [11.8962272, 46.609391], [11.895555400000003, 46.608433900000016], [11.8969287, 46.606005300000014], [11.8985713, 46.6024677], [11.8986614, 46.60227370000001], [11.8992515, 46.59947430000001], [11.897422200000003, 46.597489499999995], [11.8943216, 46.596835200000015], [11.8926157, 46.59561510000002], [11.890180200000003, 46.5946714], [11.8891288, 46.59385680000001], [11.8855239, 46.5882608], [11.8850733, 46.5843196], [11.892154300000003, 46.5832394], [11.8974115, 46.58429939999999], [11.900640800000003, 46.583158300000015], [11.901499200000003, 46.5820761], [11.9003673, 46.5813], [11.9005657, 46.58014590000001], [11.8961669, 46.577284599999984], [11.8982269, 46.57551460000001], [11.902218, 46.5707797], [11.903934600000003, 46.56794], [11.9005657, 46.560334800000014], [11.8982161, 46.5567937], [11.8902231, 46.5545177], [11.8865753, 46.5538463], [11.879695500000004, 46.5507263], [11.87531, 46.5534424], [11.872493700000003, 46.5535115], [11.866701500000003, 46.5535927], [11.859469400000004, 46.55152399999999], [11.856545300000004, 46.55131], [11.854740200000004, 46.551254699999994], [11.853187200000004, 46.5549622], [11.855193500000004, 46.5577823], [11.8607188, 46.5619171], [11.860633000000004, 46.563752100000016], [11.8585516, 46.5652145], [11.852109000000004, 46.56846], [11.851919, 46.5684826], [11.851189900000003, 46.5685695], [11.8511112, 46.56857890000002], [11.850869000000003, 46.5684295], [11.8508437, 46.568413800000016], [11.850212, 46.5680241], [11.850184300000004, 46.568007], [11.8497245, 46.56772330000001], [11.8497158, 46.5675637], [11.849526000000003, 46.5640942], [11.8453954, 46.56245290000002], [11.8387542, 46.5589968], [11.8395267, 46.5577057], [11.8495474, 46.5599263], [11.8511782, 46.555474], [11.8362759, 46.5528586], [11.8373541, 46.5495715], [11.826936400000003, 46.5494719], [11.824619, 46.550021599999994], [11.811889200000003, 46.556457099999996], [11.809936900000004, 46.5567579], [11.8032876, 46.554665099999994]]]}, "Mölltaler Gletscher": {"type": "Polygon", "coordinates": [[[12.985830200000004, 47.028577200000015], [12.9906218, 47.0268911], [12.9982969, 47.033141], [13.002921, 47.0308718], [13.0131681, 47.012058300000014], [13.0165714, 47.0100404], [13.0260047, 47.0120079], [13.0261187, 47.01380939999999], [13.0234223, 47.0220824], [13.0214596, 47.026376200000016], [13.0177866, 47.0309292], [13.018377699999997, 47.03325580000001], [13.0196772, 47.0352812], [13.0205341, 47.0359844], [13.0220464, 47.0372255], [13.0210106, 47.0399734], [13.0159795, 47.0416121], [13.0035129, 47.0373515], [12.991379199999999, 47.036116100000015], [12.9874579, 47.0328889], [12.985830200000004, 47.028577200000015]]]}, "Schmittenhöhe Zell am See": {"type": "Polygon", "coordinates": [[[12.7693741, 47.3459768], [12.7572076, 47.345467899999996], [12.7531521, 47.343868599999986], [12.748152499999998, 47.340887899999984], [12.744119099999997, 47.339491599999995], [12.7415013, 47.343243], [12.7398699, 47.3493497], [12.7366304, 47.355833], [12.7327251, 47.3575192], [12.7298415, 47.3648251], [12.7252389, 47.3650084], [12.7216529, 47.3637111], [12.7268028, 47.359321599999994], [12.731909699999997, 47.3557749], [12.7386045, 47.3455984], [12.7403848, 47.3365401], [12.7361319, 47.3349332], [12.733878899999997, 47.33568939999999], [12.7286486, 47.3363947], [12.728863099999995, 47.334940499999995], [12.7295069, 47.33198839999999], [12.728391099999994, 47.3288906], [12.7245931, 47.32896330000001], [12.7204893, 47.328607], [12.718279099999997, 47.32254190000001], [12.7193574, 47.3223892], [12.7214549, 47.32313820000002], [12.723686500000003, 47.324869099999994], [12.7267978, 47.32497090000001], [12.7329991, 47.32569820000001], [12.7339449, 47.3247786], [12.735123399999997, 47.32363280000001], [12.738020199999998, 47.3224255], [12.7499077, 47.315065], [12.7658508, 47.3074124], [12.7664784, 47.30641230000001], [12.767267, 47.306423], [12.771065, 47.304298599999996], [12.7742665, 47.302618], [12.7782147, 47.3010028], [12.7800815, 47.3005954], [12.7830427, 47.3002316], [12.787269799999999, 47.29896560000002], [12.7861976, 47.29838320000002], [12.786834, 47.29808890000002], [12.787051, 47.2978642], [12.7872447, 47.2976636], [12.7896488, 47.29849990000002], [12.7903475, 47.29866310000001], [12.7907846, 47.298724600000014], [12.7913341, 47.29879060000002], [12.7913848, 47.29936780000001], [12.7915192, 47.30084239999999], [12.7908759, 47.301556], [12.791977099999997, 47.3024011], [12.7897846, 47.3023602], [12.7894523, 47.3017593], [12.7875921, 47.3020267], [12.7946898, 47.321899599999995], [12.7945447, 47.3239015], [12.7922039, 47.3243007], [12.7883313, 47.3252006], [12.7815249, 47.3255491], [12.77783, 47.32579420000001], [12.7748894, 47.326795900000015], [12.777678799999999, 47.3324315], [12.7785158, 47.333187699999996], [12.7782962, 47.3337044], [12.7775501, 47.3339367], [12.7737306, 47.334722], [12.7721915, 47.33610380000001], [12.7698634, 47.3368527], [12.7667563, 47.3365546], [12.766413, 47.336845499999995], [12.766928, 47.337543499999995], [12.769584400000003, 47.3390194], [12.7731078, 47.34053890000001], [12.7728932, 47.341120499999995], [12.7697604, 47.3417021], [12.7695029, 47.3425164], [12.7692025, 47.344028499999986], [12.7693741, 47.3459768]]]}, "Arabba": {"type": "Polygon", "coordinates": [[[11.812936700000003, 46.488910300000015], [11.8122272, 46.487460699999986], [11.8131727, 46.48591860000001], [11.816441000000003, 46.4839868], [11.8131499, 46.4805054], [11.812651, 46.4788025], [11.8129983, 46.47831580000002], [11.815149500000004, 46.4772001], [11.8239015, 46.48212890000001], [11.836347, 46.484287899999984], [11.8406171, 46.4852907], [11.844329199999999, 46.4863397], [11.846475, 46.4854532], [11.8533629, 46.48428599999999], [11.8560237, 46.479883], [11.863619700000003, 46.47556820000001], [11.865422100000004, 46.4721842], [11.8712801, 46.4722285], [11.879498400000003, 46.4784201], [11.8843156, 46.4730191], [11.892544600000006, 46.4688886], [11.8914074, 46.4644547], [11.8929201, 46.463752700000015], [11.8946097, 46.4631747], [11.8959135, 46.4658883], [11.8997544, 46.4702039], [11.899024800000003, 46.471622599999996], [11.8879634, 46.4746003], [11.882609700000003, 46.480089799999995], [11.8821591, 46.48335520000001], [11.879949000000003, 46.4854311], [11.8773955, 46.493549], [11.8776703, 46.495752500000016], [11.877792500000004, 46.49673230000002], [11.872621200000003, 46.499044], [11.8679649, 46.5026184], [11.8632227, 46.5054394], [11.866527200000004, 46.5082011], [11.8689734, 46.511066099999994], [11.872610400000003, 46.5159613], [11.8737331, 46.5169499], [11.872624000000004, 46.5186916], [11.872145900000003, 46.5192538], [11.8713102, 46.519668499999995], [11.866639800000007, 46.516027699999995], [11.864419000000003, 46.5138238], [11.8601006, 46.5126462], [11.8582123, 46.5108583], [11.8581178, 46.5107687], [11.8567747, 46.509497], [11.856772800000003, 46.5088454], [11.856769300000003, 46.50766939999999], [11.859585600000006, 46.50557970000001], [11.860004100000003, 46.5036744], [11.859910500000003, 46.5035264], [11.8589955, 46.50207930000001], [11.859688400000003, 46.5000304], [11.859853900000003, 46.4991696], [11.865904900000004, 46.4965698], [11.866999300000003, 46.4941842], [11.8610555, 46.493334800000014], [11.8542319, 46.4910155], [11.8474406, 46.4886222], [11.8434924, 46.488718300000016], [11.841342, 46.4887273], [11.8147781, 46.488839], [11.812936700000003, 46.488910300000015]]]}, "Skicircus Saalbach-Hinterglemm Leogang Fieberbrunn": {"type": "Polygon", "coordinates": [[[12.5500682, 47.3456622], [12.5768735, 47.3467903], [12.653929, 47.3604234], [12.661119, 47.364047199999995], [12.6864621, 47.380452], [12.698778999999998, 47.39657730000001], [12.708928399999994, 47.3879923], [12.720193799999999, 47.3820501], [12.7246141, 47.3741311], [12.728455, 47.375468], [12.7300643, 47.3719949], [12.7295493, 47.3688269], [12.7297541, 47.3677077], [12.7298415, 47.3648251], [12.738818999999998, 47.364932], [12.731008399999997, 47.3771971], [12.7242063, 47.38068439999998], [12.7214812, 47.38608899999999], [12.7133273, 47.3889801], [12.7064609, 47.3991045], [12.7152293, 47.40215040000001], [12.7193355, 47.408806], [12.7265452, 47.414788599999994], [12.7355575, 47.421177], [12.735634300000003, 47.4214096], [12.7367047, 47.42465280000001], [12.7375316, 47.427158300000016], [12.745170499999999, 47.429597], [12.746200499999999, 47.4307292], [12.748088799999998, 47.43601270000001], [12.7565431, 47.436854499999995], [12.757616, 47.43363230000001], [12.7597618, 47.433487099999994], [12.7618386, 47.4367652], [12.7619504, 47.4369416], [12.759161, 47.439525], [12.746458, 47.4374931], [12.7438831, 47.4317453], [12.7362871, 47.4324711], [12.7374673, 47.4386397], [12.7351125, 47.44021270000001], [12.714958099999997, 47.441324599999994], [12.704157499999999, 47.440395], [12.7031993, 47.4382478], [12.7123832, 47.412697599999994], [12.701911799999998, 47.40619200000001], [12.6916122, 47.4024741], [12.6763343, 47.4050883], [12.6609609, 47.40893800000001], [12.6606014, 47.40903390000001], [12.6532939, 47.4109959], [12.6444911, 47.4092707], [12.6290416, 47.414091599999985], [12.627067499999999, 47.4126396], [12.635221399999997, 47.4087479], [12.632303199999999, 47.401312200000014], [12.596936000000003, 47.410657799999996], [12.591361999999998, 47.410606599999994], [12.5792598, 47.4190283], [12.573436900000006, 47.41835190000001], [12.5706913, 47.4203271], [12.5687884, 47.42547430000001], [12.5543689, 47.4278551], [12.559690400000003, 47.4392348], [12.5708484, 47.4503798], [12.5644111, 47.460884199999995], [12.5493907, 47.4690078], [12.5408076, 47.459781699999986], [12.5402526, 47.4595422], [12.532739600000003, 47.456299699999995], [12.546215, 47.444227099999985], [12.552309000000003, 47.43859620000001], [12.5438975, 47.4290744], [12.5390052, 47.4258808], [12.5510661, 47.42081260000001], [12.556744700000003, 47.4165004], [12.5602178, 47.4139391], [12.563566500000004, 47.41251370000001], [12.5670024, 47.4125472], [12.5768019, 47.4155285], [12.582092200000004, 47.407469899999995], [12.530255499999999, 47.3922891], [12.534121299999997, 47.38512220000001], [12.545549900000003, 47.381739], [12.5454504, 47.37611260000001], [12.5500682, 47.3456622]]]}, "Turracher Höhe": {"type": "Point", "coordinates": [13.877777777778, 46.913888888889]}, "Sípark Mátraszentistván": {"type": "Point", "coordinates": [19.8615, 47.92428]}};
        const initialAvailableAreas = ["Alta Badia", "Arabba", "Mölltaler Gletscher", "Obertauern", "Schmittenhöhe Zell am See", "Skicircus Saalbach-Hinterglemm Leogang Fieberbrunn", "Síaréna Vibe Park", "Sípark Mátraszentistván", "Sölden", "Turracher Höhe", "Val Gardena, Gröden, Gherdëina"];
        const trackLayerGroup = L.layerGroup().addTo(map);
        let availableAreas = new Set(initialAvailableAreas);
        let currentScheme = 1;

        function populateSelectorInitial() {
            const selector = document.getElementById("area");
            const existing = new Set(Array.from(selector.options).map(o => o.value));
            initialAvailableAreas.forEach(area => {
                if (!existing.has(area)) {
                    const opt = document.createElement("option");
                    opt.value = area;
                    opt.textContent = area;
                    selector.appendChild(opt);
                }
            });
        }
        populateSelectorInitial();

        async function loadGeoJSON(path) {
            if (loadedFiles.has(path)) return;
            try {
                const response = await fetch(path);
                const data = await response.json();
                data.features.forEach(f => {
                    if (f && f.properties && f.properties.ski_area) {
                        availableAreas.add(f.properties.ski_area);
                    }
                });
                updateSelectorFromSet();

                const layer = L.geoJSON(data, {
                    filter: function(feature) {
                        const selectedArea = document.getElementById("area").value;
                        return selectedArea === "all" || feature.properties.ski_area === selectedArea;
                    },
                    style: function(feature) {
                        // take the precomputed scheme color from properties
                        const color = feature.properties["scheme" + currentScheme];
                        return {
                            color: color,
                            weight: lineWidth,
                            opacity: map.getZoom() >= MIN_ZOOM ? 1 : 0,
                            zIndex: feature.properties.z_index
                        };
                    },
                    interactive: false,
                    pmIgnore: true,
                    renderer: L.canvas({ padding: 0.5 }),
                });
                layer.addTo(trackLayerGroup);
                loadedFiles.add(path);
            } catch (error) {
                console.error('Failed to load track file:', path, error);
            }
        }

        function updateSelectorFromSet() {
            const selector = document.getElementById("area");
            const existing = new Set(Array.from(selector.options).map(o => o.value));
            Array.from(availableAreas).sort().forEach(area => {
                if (!existing.has(area)) {
                    const opt = document.createElement("option");
                    opt.value = area;
                    opt.textContent = area;
                    selector.appendChild(opt);
                }
            });
        }

        document.getElementById("scheme").addEventListener("change", function() {
            currentScheme = parseInt(this.value) || 1;
            trackLayerGroup.clearLayers();
            loadedFiles.clear();
            updateVisibility();
        });

        document.getElementById("area").addEventListener("change", function() {
            trackLayerGroup.clearLayers();
            loadedFiles.clear();
            updateVisibility();
            const selectedArea = this.value;
            if (selectedArea !== "all" && skiAreas[selectedArea]) {
                const layer = L.geoJSON(skiAreas[selectedArea]);
                try {
                    const bounds = layer.getBounds();
                    if (bounds && bounds.isValid()) {
                        map.fitBounds(bounds, { maxZoom: MIN_ZOOM });
                        if (map.getZoom() < MIN_ZOOM) map.setZoom(MIN_ZOOM);
                    }
                } catch (e) {
                    console.warn('Could not fit bounds for selected area:', e);
                }
            }
        });

        async function getFeaturesInView() {
            if (map.getZoom() < MIN_ZOOM) return [];
            const bounds = map.getBounds();
            try {
                const response = await fetch('tracks_geojson/chunk_bboxes.json');
                const chunkBBoxes = await response.json();
                const expandedBounds = L.latLngBounds(
                    [bounds.getSouth() - MAX_LOAD_DISTANCE, bounds.getWest() - MAX_LOAD_DISTANCE],
                    [bounds.getNorth() + MAX_LOAD_DISTANCE, bounds.getEast() + MAX_LOAD_DISTANCE]
                );
                const filesToLoad = [];
                for (const [file, bbox] of Object.entries(chunkBBoxes)) {
                    const chunkBounds = L.latLngBounds([bbox[1], bbox[0]], [bbox[3], bbox[2]]);
                    if (expandedBounds.overlaps(chunkBounds)) {
                        filesToLoad.push(file);
                    }
                }
                return filesToLoad;
            } catch (error) {
                console.error('Error loading chunk_bboxes.json:', error);
                return [];
            }
        }

        async function loadVisibleFeatures() {
            if (map.getZoom() < MIN_ZOOM) return;
            const filesToLoad = await getFeaturesInView();
            const loadPromises = filesToLoad.map(path => loadGeoJSON(`tracks_geojson/${path}`));
            await Promise.all(loadPromises);
        }

        function throttledUpdateVisibility() {
            const now = Date.now();
            if (now - lastUpdate > UPDATE_INTERVAL) {
                updateVisibility();
                lastUpdate = now;
            }
        }

        function updateVisibility() {
            const currentZoom = map.getZoom();
            const shouldShow = currentZoom >= MIN_ZOOM;
            trackLayerGroup.eachLayer(layer => {
                layer.eachLayer(featureLayer => {
                    if (featureLayer.setStyle) {
                        featureLayer.setStyle({ opacity: shouldShow ? 1 : 0 });
                    }
                });
            });
            if (shouldShow) loadVisibleFeatures();
        }

        map.whenReady(function() {
            if (map.getZoom() >= MIN_ZOOM) loadVisibleFeatures();
            map.on('zoomend', throttledUpdateVisibility);
            map.on('moveend', throttledUpdateVisibility);
            updateVisibility();
        });
    });
    </script>
    
    
            <div class="folium-map" id="map_21114c0494e2dc7651fcbfec261e5e6c" ></div>
        
</body>
<script>
    
    
            var map_21114c0494e2dc7651fcbfec261e5e6c = L.map(
                "map_21114c0494e2dc7651fcbfec261e5e6c",
                {
                    center: [47.85, 16.01],
                    crs: L.CRS.EPSG3857,
                    ...{
  "zoom": 6,
  "zoomControl": true,
  "preferCanvas": true,
}

                }
            );

            

        
    
            var tile_layer_2227e14984baed5e9140eddaf5624ed4 = L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
  "minZoom": 0,
  "maxZoom": 19,
  "maxNativeZoom": 19,
  "noWrap": false,
  "attribution": "Map data \u00a9 OpenStreetMap contributors",
  "subdomains": "abc",
  "detectRetina": false,
  "tms": false,
  "opacity": 1,
}

            );
        
    
            tile_layer_2227e14984baed5e9140eddaf5624ed4.addTo(map_21114c0494e2dc7651fcbfec261e5e6c);
        
    
            var locate_control_87d460973086dbd0bffe895ed2c7513c = L.control.locate(
                {"locate_options": {"enableHighAccuracy": true}, "position": "topright", "strings": {"title": "Show my location"}}
            ).addTo(map_21114c0494e2dc7651fcbfec261e5e6c);
            
        
</script>
</html>